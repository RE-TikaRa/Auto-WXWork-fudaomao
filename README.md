# 辅导猫自动签到脚本

基于 AutoJs6 的企业微信辅导猫自动签到工具，支持多活动批量签到。

## 功能特性

- 通知触发 - 收到签到通知时自动执行
- 备用定时 - 错过通知也能按时签到
- 批量处理 - 自动遍历今日所有打卡活动
- 智能跳过 - 已签到的活动自动跳过
- 范围外签到 - 自动填写原因并拍照
- 超时保护 - 3 分钟全局超时，防止卡死

## 环境要求

| 要求 | 说明 |
|------|------|
| 系统 | Android 7.0+ (`API 24`) |
| 软件 | [AutoJs6](https://github.com/SuperMonster003/AutoJs6/releases/latest) |
| 账号 | 企业微信已登录并加入辅导猫 |
| 权限 | 无障碍服务、通知访问权限 |
| 锁屏 | 无锁屏密码或启用 Smart Lock |

## 测试环境

| 项目 | 信息 |
|------|------|
| 设备 | 一加 ACE 3 (OnePlus PJE110) |
| 系统 | ColorOS 16.0.2.400 (PJEI10_CNOIB30POI) |

## 项目结构

```
auto-workwx/
├── main.js                 # 自动签到服务（通知监听 + 备用定时）
├── project.json            # AutoJs6 项目配置
├── README.md
└── tools/
    ├── manual-checkin.js   # 手动签到（立即执行一次）
    └── analyze-screen.js   # 界面分析调试工具
```

## 快速开始

### 1. 安装 AutoJs6

1. 访问 [AutoJs6 发布页](https://github.com/SuperMonster003/AutoJs6/releases/latest)
2. 下载最新版本 APK 并安装
3. 打开 AutoJs6，按提示授予基本权限

### 2. 下载项目

1. 访问本项目 [Releases 页面](../../releases/latest)
2. 下载最新版本压缩包
3. 解压到 AutoJs6 工作目录：
   - 默认路径：`/sdcard/脚本/` 或 `/sdcard/Scripts/`，
   - 若无可自行创建，然后在AutoJs6中修改目录。
   - 可在 AutoJs6 设置中查看或修改工作目录

### 3. 授予权限

在手机设置中为 AutoJs6 开启以下权限：

| 权限 | 设置路径 | 必需 |
|------|----------|------|
| 无障碍服务 | 设置 → 无障碍 → 已下载的应用 → AutoJs6 | ✅ |
| 通知访问 | 设置 → 应用 → 特殊应用权限 → 通知访问 → AutoJs6 | ✅ |
| 后台运行 | 设置 → 电池 → AutoJs6 → 无限制 | ✅ |
| 悬浮窗 | 设置 → 应用 → 特殊应用权限 → 显示在其他应用上层 | 可选 |

> 不同品牌手机设置路径可能略有不同，但是AutoJs6给了开关 ~~(方便多了)~~

### 4. 修改配置

编辑 `main.js` 文件顶部的 `CONFIG` 对象：

```javascript
var CONFIG = {
    packageName: "com.tencent.wework",  // 企业微信包名（一般无需修改）
    reasonText: "离校",                  // 范围外签到时填写的原因
    entryText: "辅导猫",                 // 企业微信工作台中辅导猫入口文本
    keywords: ["打卡", "签到", "辅导猫"], // 通知触发关键词
    startHour: 7,                        // 通知触发时段开始（小时）
    startMinute: 50,                     // 通知触发时段开始（分钟）
    endHour: 8,                          // 通知触发时段结束（小时）
    endMinute: 10,                       // 通知触发时段结束（分钟）
    fallbackHour: 10,                    // 备用定时签到（小时）
    fallbackMinute: 30                   // 备用定时签到（分钟）
};
```

**配置说明：**

| 参数 | 默认值 | 说明 |
|------|--------|------|
| `reasonText` | `"离校"` | 范围外签到时自动填写的原因 |
| `keywords` | `["打卡", "签到", "辅导猫"]` | 通知标题或内容包含任一关键词即触发 |
| `startHour:startMinute` | `07:50` | 通知触发生效开始时间 |
| `endHour:endMinute` | `08:10` | 通知触发生效结束时间 |
| `fallbackHour:fallbackMinute` | `10:30` | 备用定时签到时间（当通知触发时段内未签到时执行） |

> 手动签到的配置在 `tools/manual-checkin.js` 顶部，格式相同

### 5. 运行脚本

**自动签到（推荐）**

1. 在 AutoJs6 中打开项目
2. 运行 `main.js`
3. 保持 AutoJs6 在后台运行

运行后会显示：
```
===== 辅导猫自动签到服务 =====
监听包名: com.tencent.wework
触发关键词: 打卡, 签到, 辅导猫
通知触发时段: 07:50 - 08:10
备用定时: 10:30 (如通知未触发)

监听中... (保持脚本运行)
```

**手动签到**

运行 `tools/manual-checkin.js`，立即执行一次签到流程。

## 工作原理

### 触发逻辑

```
┌──────────────────────────────────────────────────────────────┐
│                      main.js 运行中                           │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│  [通知触发] 07:50 - 08:10                                     │
│  ├─ 收到企业微信通知                                          │
│  ├─ 检查是否匹配关键词                                        │
│  │   ├─ 匹配 → 执行签到 → 标记今日已完成                      │
│  │   └─ 不匹配 → 忽略                                        │
│                                                              │
│  [备用定时] 10:30                                             │
│  ├─ 检查今日是否已签到                                        │
│  │   ├─ 未签到 → 执行签到                                    │
│  │   └─ 已签到 → 跳过                                        │
│                                                              │
│  [日期重置] 00:00                                             │
│  └─ 重置每日签到标记，准备第二天                              │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

### 签到流程

```
唤醒屏幕 → 上滑解锁 → 杀掉企业微信后台 → 启动企业微信
    ↓
进入辅导猫 → 查找今日活动
    ↓
┌─ 遍历每个活动 ─────────────────────────────────┐
│                                               │
│  检查签到状态                                  │
│  ├─ 已签到 → 跳过，处理下一个                  │
│  └─ 未签到 → 继续                             │
│       ↓                                       │
│  点击签到按钮                                  │
│       ↓                                       │
│  处理范围外签到弹窗（如有）                     │
│       ↓                                       │
│  去拍照 → 点击快门 → 使用照片                  │
│       ↓                                       │
│  填写原因 → 收起键盘 → 完成签到                │
│       ↓                                       │
│  返回活动列表，处理下一个                       │
│                                               │
└───────────────────────────────────────────────┘
    ↓
输出签到结果汇总
```

## 锁屏设置

脚本需要在屏幕解锁状态下运行。推荐以下方案：

**方案一：禁用锁屏（最简单）**

设置 → 安全 → 屏幕锁定 → 选择"无"

**方案二：Smart Lock 信任场所**

1. 设置 → 安全 → Smart Lock
2. 添加"信任的地点"（如宿舍、家）
3. 在信任地点时设备自动保持解锁

**方案三：Smart Lock 信任设备**

1. 设置 → 安全 → Smart Lock
2. 添加"信任的蓝牙设备"（如手环、耳机）
3. 连接信任设备时自动保持解锁

## 常见问题

**Q: 脚本运行后没有反应？**

A: 检查无障碍服务是否开启，部分手机需要重新开启才能生效。

**Q: 通知触发不工作？**

A: 检查通知访问权限是否授予，确认企业微信通知没有被静音。

**Q: 脚本被系统杀掉？**

A: 关闭 AutoJs6 的电池优化，将其加入后台白名单。

**Q: 找不到签到按钮？**

A: 使用 `tools/analyze-screen.js` 分析当前界面，根据输出调整脚本。

**Q: 如何修改配置？**

A: 直接编辑 `main.js` 顶部的 `CONFIG` 对象，保存后重新运行脚本。

## 注意事项

- 拍照时请遮挡摄像头（实现黑屏照片）
- 首次运行建议手动观察整个流程
- 脚本有 3 分钟全局超时保护
- 需要保持 AutoJs6 后台运行
- 建议关闭电池优化，防止被系统杀掉

## License

MIT
